#!/usr/bin/env bash

set -evuo pipefail

ARGS=(
"--tiller-namespace=${K8S_NAMESPACE}"
'--install'
"--namespace=${K8S_NAMESPACE}"
'fiaas-mast'
'./helm/fiaas-mast'
'--set' "image.tag=${IMAGE_TAG}"
'--set' "secrets.token=${HEIMDALL_TOKEN}"
'--set' "secrets.artifactoryUser=${ARTIFACTORY_USER}"
'--set' "secrets.artifactoryPassword=${ARTIFACTORY_PWD}"
)

if [[ $K8S_NAMESPACE =~ "delivery-dev" ]]; then
    ARGS=(
        "${ARGS[@]}"
        '--set' 'besteffortQoS=true'
        '--set' 'ingress.host=fiaas-mast-dev.ingress.cre-pro.schibsted.io'
    )
fi


helm upgrade "${ARGS[@]}"
